
<!DOCTYPE html>
<html lang='ar' dir='rtl'>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    {% load static %}
    <link rel='stylesheet' type='text/css' media='screen' href="{% static 'SEC_App/style.css' %}?version=18">
    <script src="{% static 'SEC_App/search.js' %}" defer></script>

    <!-- Tajawal font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal&display=swap" rel="stylesheet">

    <!-- chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.3.2/chart.min.js" ></script>

    <!-- print pdf -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript">
        $("#btnPrint").live("click", function () {
            var divContents = $("#dvContainer").html();
            var printWindow = window.open('', '', 'height=400,width=800');
            printWindow.document.write('<html><head><title>DIV Contents</title>');
            printWindow.document.write('</head><body >');
            printWindow.document.write(divContents);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        });
    </script>
    

</head>
<body>  
  <div id='dvContainer'>
  <h1>النتائج والتحليلات</h1>
  <div id='search-details'>
    <table>
      <tr>
        <th>كلمات البحث:</th>
        <td>{{req.keyword}}</td>
      </tr>
    </table>
    <table>
      <tr>
        <th>من:</th>
        <td>{{from_date}}</td>
        <th>إلى:</th>
        <td>{{to_date}}</td>
      </tr>
    </table>
  </div>
  <br><br>
  <div class="center-wrapper">
  <div id="pie-chart-container" class="relative">
    <!-- <span>تحليل المشاعر</span> -->
    <canvas id="sentiment-pie-chart"></canvas>
    <div class="absolute-center text-center">
      <p>عدد التغريدات:</p>
      <p>{{num_tweets}}</p>
    </div>
  </div>
  <div id="myCahrt-container">
    <span>التفاعل مع التغريدات</span>
    <canvas id="reactions-bar-chart" width="30%" height="30%" style='display: "inline-block" !important;'></canvas>
  </div>
 </div>
  <br><br><br>
  <div id="week-days-container" style='display: "inline-block"'>
    <canvas id="myChart2" width="500" height="500" style='display: "inline-block" !important;'></canvas>
    <button id="0" type="button" >أيام</button>
    <button id="1" type="button" >أشهر</button>
  </div>
  <div id="wordcloud-container">
    <span>سحابة الكلمات</span>
    <br><br>
    <img src="{% static 'SEC_App/wordcloud.png' %}" alt="wordcloud" style='display: "inline-block"'>
  </div>
  <div id='tweets-list'>
  <h2>من التغريدات</h2>
    <table>
    {% for tweet in tweets_list %}
        <tr>
          <td class="counter">{{ forloop.counter }}</td>
          <td>{{ tweet }}</td>
        </tr>
    {% endfor %}
    </table>
  </div>


<script>
  var reactions = JSON.parse("{{ reactions|escapejs }}");

  var likes = reactions['likes'];
  var replies = reactions['replies'];
  var retweets = reactions['retweets'];


  var ctx = document.getElementById("reactions-bar-chart");

  // setup
  const DATA_COUNT = 3;

  const labels = ['سلبي', 'طبيعي', 'إيجابي'];
  const data = {
    labels: labels,
    datasets: [
      {
        label: 'إعجابات',
        data: likes,
        backgroundColor: 'rgba(255, 99, 132, 1)',
        borderColor: 'rgba(255, 99, 132, 1)',
        borderWidth: 1,
        hoverOffset: 4
      },
      {
        label: 'إعادات التغريد',
        data: retweets,
        backgroundColor: 'rgba(54, 162, 235, 1)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1,
        hoverOffset: 4
      },
      {
        label: 'الردود',
        data: replies,
        backgroundColor: 'rgba(255, 206, 86, 1)', 
        borderColor: 'rgba(255, 206, 86, 1)',
        borderWidth: 1,
        hoverOffset: 4
      },
    ]
  };

  // config
  const config = {
      type: 'bar',
      data: data,
      options: {
        plugins: {
          legend: {
        labels: {
          color: 'rgba(240, 248, 255, 1)', 
          font: {
            size: 14,
            family: "'Tajawal', sans-serif",
          }
        }
      },
          title: {
            display: true,
            text: '',
            fontColor: 'rgba(240, 248, 255, 1)',
          },
        },
        responsive: true,
        scales: {
          x: {
            stacked: true,
            ticks: {
              color: 'rgba(240, 248, 255, 1)', 
              font: {
              size: 14, 
              family: "'Tajawal', sans-serif",
              },
            },
          },
          y: {
            stacked: true,
            ticks: {
              color: 'rgba(240, 248, 255, 1)', 
              font: {
              size: 14, 
              family: "'Tajawal', sans-serif",
              },
            },
          }
        }
      }
    };
  // 'rgba(240, 248, 255, 1)'
  // action
  const actions = [
      {
        name: 'Randomize',
        handler(chart) {
          chart.data.datasets.forEach(dataset => {
            dataset.data = Utils.numbers({count: chart.data.labels.length, min: 0});
          });
          chart.update();
        }
      },
    ];

  var chart = new Chart(ctx, config, actions)
</script>
<script>
  var period_data = JSON.parse("{{ period_data|escapejs }}");

  var negativeData = period_data['negativeDays'];
  var neutralData = period_data['neutralDays'];
  var positiveData = period_data['positiveDays'];

  var postiveD = period_data['negativeMonths'];
  var NegativeD = period_data['neutralMonths'];
  var NatD = period_data['positiveMonths'];

  var ctx2 = document.getElementById("myChart2");

  var chart3 , chart2;
  function Days_period(){

  // setup
  const DATA_COUNT2 = 7;
  const NUMBER_CFG = {count: DATA_COUNT2, min: -100, max: 100};

  const labels2 = ['السبت','الجمعة','الخميس','الاربعاء','الثلاثاء','الاثنين','الاحد'];

  const data2 = {
    labels: labels2,
    datasets: [
      {
        label: 'ايجابي',
        data: positiveData,
        borderColor: 'rgba(255, 206, 86, 1)',
        backgroundColor: 'rgba(255, 206, 86, 1)',
        yAxisID: 'y',
      },
      {
        label: 'سلبي',
        data: negativeData,
        borderColor: 'rgba(255, 99, 132, 1)',
        backgroundColor: 'rgba(255, 99, 132, 1)',
        yAxisID: 'y',
      },
      {
        label: 'طبيعي',
        data: neutralData,
        borderColor: 'rgba(54, 162, 235, 1)',
        backgroundColor: 'rgba(54, 162, 235, 1)',
        yAxisID: 'y',
      }
    ]
  };

  // config
  const config2 = {
    type: 'line',
    data: data2,
    options: {
      responsive: true,
      interaction: {
        mode: 'index',
        intersect: false,
      },
      stacked: false,
      plugins: {
        legend: {
        labels: {
          color: 'rgba(240, 248, 255, 1)', 
          font: {
            size: 14,
            family: "'Tajawal', sans-serif",
          }
        }
      },
        title: {
          display: true,
          text: 'تفاعل مع الأيام',
          color: 'rgba(240, 248, 255, 1)',
          font: {
          size: 22,
          family: "'Tajawal', sans-serif",
          },
        }
      },
      scales: {
        x: {
          ticks: {
            color: 'rgba(240, 248, 255, 1)', 
            font: {
            size: 14, 
            family: "'Tajawal', sans-serif",
            },
            },
          grid: {
            color: 'rgba(255, 255, 255, 0.3)',
        },
        },
        y: {
          type: 'linear',
          display: true,
          position: 'left',
          ticks: {
            color: 'rgba(240, 248, 255, 1)', 
            font: {
            size: 14, 
            family: "'Tajawal', sans-serif",
            },
            },
          grid: {
            color: 'rgba(255, 255, 255, 0.3)',
        },
        },
      }
    },
  };
  const actions2 = [
    {
      name: 'Randomize',
      handler(chart2) {
        chart2.data.datasets.forEach(dataset => {
          dataset.data = Utils.numbers({count: chart2.data.labels.length, min: -100, max: 100});
        });
        chart2.update();
      }
    },
  ];
  var chart2 = new Chart(ctx2, config2, actions2)

  // add event listeners for the buttons
  document.getElementById("1").addEventListener('click', () => {
    chart2.destroy();
    Month_period();
  });
  }

  function Month_period(){
  // setup
  const DATA_COUNT3 = 12;
  const NUMBER_CFG = {count: DATA_COUNT3, min: -100, max: 100};

  const labels3 = ['12','11', '10', '9', '8', '7', '6', '5', '4', '3', '2', '1'];

  const data3 = {
    labels: labels3,
    datasets: [
      {
        label: 'ايجابي',
        data: postiveD,
        borderColor: 'rgba(255, 206, 86, 1)',
        backgroundColor: 'rgba(255, 206, 86, 1)',
        yAxisID: 'y',
      },
      {
        label: 'سلبي',
        data: NegativeD,
        borderColor: 'rgba(255, 99, 132, 1)',
        backgroundColor: 'rgba(255, 99, 132, 1)',
        yAxisID: 'y',
      },
      {
        label: 'طبيعي',
        data: NatD,
        borderColor: 'rgba(54, 162, 235, 1)',
        backgroundColor: 'rgba(54, 162, 235, 1)',
        yAxisID: 'y',
      }
    ]
  };

  // config
  const config3 = {
    type: 'line',
    data: data3,
    options: {
      responsive: true,
      interaction: {
        mode: 'index',
        intersect: false,
      },
      stacked: false,
      plugins: {
        legend: {
        labels: {
          color: 'rgba(240, 248, 255, 1)', 
          font: {
            size: 14,
            family: "'Tajawal', sans-serif",
          }
        }
      },
        title: {
          display: true,
          text: 'تفاعل مع الاشهر',
          color: 'rgba(240, 248, 255, 1)',
          font: {
          size: 22,
          family: "'Tajawal', sans-serif",
          },
        }
      },
      scales: {
        x :{
          ticks: {
            color: 'rgba(240, 248, 255, 1)', 
            font: {
            size: 14, 
            family: "'Tajawal', sans-serif",
            },
          },
            grid: {
              color: 'rgba(255, 255, 255, 0.3)',
          },
        },
        y: {
          type: 'linear',
          display: true,
          position: 'left',
          ticks: {
            color: 'rgba(240, 248, 255, 1)', 
            font: {
            size: 14, 
            family: "'Tajawal', sans-serif",
            },
          },
          grid: {
            color: 'rgba(255, 255, 255, 0.3)',
          },
        },
      }
    },
  };
  const actions3 = [
    {
      name: 'Randomize',
      handler(chart3) {
        chart3.data.datasets.forEach(dataset => {
          dataset.data = Utils.numbers({count: chart3.data.labels.length, min: -100, max: 100});
        });
        chart3.update();
      }
    },
  ];
  chart3 = new Chart(ctx2, config3, actions3)
  // add event listeners for the buttons
  document.getElementById("0").addEventListener('click', () => {
    chart3.destroy();
    Days_period();
  });
  }
  Days_period();


</script>
<script>
  var reactions = JSON.parse("{{ sentiment_data|escapejs }}");

  var pie_ctx = document.getElementById("sentiment-pie-chart");
  //setup
  const data_pie = {
    labels: ['إيجابي', 'سلبي', 'طبيعي'],
    datasets: [
      {
        label: 'Sentiment',
        data: reactions['sentiment'],
        backgroundColor: [
        'rgb(54, 162, 235)',
        'rgb(255, 99, 132)',
        'rgb(255, 205, 86)'
        ],
        hoverOffset: 4
      }
    ]
  };

  //config
  const config_pie = {
  type: 'doughnut',
  data: data_pie,
  options: {
    responsive: true,
    plugins: {
      legend: {
        position: 'top',
        labels: {
          color: 'rgba(240, 248, 255, 1)',  
          font: {
            size: 14,
            family: "'Tajawal', sans-serif",
          }
        }
      },
      title: {
        display: true,
        text: ''
      }
    }
  },
  };

  //actions
  const actions_pie = [
  {
    name: 'Randomize',
    handler(chart) {
      chart.data.datasets.forEach(dataset => {
        dataset.data = Utils.numbers({count: chart.data.labels.length, min: 0, max: 100});
      });
      chart.update();
    }
  },
  {
    name: 'Add Dataset',
    handler(chart) {
      const data = chart.data;
      const newDataset = {
        label: 'Dataset ' + (data.datasets.length + 1),
        backgroundColor: [],
        data: [],
      };

      for (let i = 0; i < data.labels.length; i++) {
        newDataset.data.push(Utils.numbers({count: 1, min: 0, max: 100}));

        const colorIndex = i % Object.keys(Utils.CHART_COLORS).length;
        newDataset.backgroundColor.push(Object.values(Utils.CHART_COLORS)[colorIndex]);
      }

      chart.data.datasets.push(newDataset);
      chart.update();
    }
  },
  {
    name: 'Add Data',
    handler(chart) {
      const data = chart.data;
      if (data.datasets.length > 0) {
        data.labels.push('data #' + (data.labels.length + 1));

        for (var index = 0; index < data.datasets.length; ++index) {
          data.datasets[index].data.push(Utils.rand(0, 100));
        }

        chart.update();
      }
    }
  },
  {
    name: 'Remove Dataset',
    handler(chart) {
      chart.data.datasets.pop();
      chart.update();
    }
  },
  {
    name: 'Remove Data',
    handler(chart) {
      chart.data.labels.splice(-1, 1); // remove the label first

      chart.data.datasets.forEach(dataset => {
        dataset.data.pop();
      });

      chart.update();
    }
  }
];
var chart = new Chart(pie_ctx, config_pie, actions_pie)

</script>
</div>
<button id="btnPrint"> اطبع </h4>
</body>
</html>